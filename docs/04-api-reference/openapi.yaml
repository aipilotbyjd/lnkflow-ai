openapi: 3.1.0
info:
  title: LinkFlow API
  description: |
    LinkFlow is a high-performance workflow automation platform.
    This API serves as the control plane for managing workspaces, workflows,
    credentials, and executions.
  version: 1.0.0
  contact:
    name: LinkFlow Support
    email: support@linkflow.io
  license:
    name: Proprietary
    url: https://linkflow.io/terms

servers:
  - url: http://localhost:8000/api/v1
    description: Local development
  - url: https://api.linkflow.io/api/v1
    description: Production

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: User authentication and registration
  - name: User
    description: User profile management
  - name: Workspaces
    description: Workspace management
  - name: Members
    description: Workspace member management
  - name: Invitations
    description: Team invitations
  - name: Workflows
    description: Workflow CRUD and execution
  - name: Executions
    description: Workflow execution history
  - name: Credentials
    description: Credential management
  - name: Webhooks
    description: Webhook management
  - name: Variables
    description: Environment variables
  - name: Tags
    description: Resource tagging
  - name: Nodes
    description: Available node types
  - name: Plans
    description: Subscription plans

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Returns the health status of the API
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time

  /plans:
    get:
      tags: [Plans]
      summary: List subscription plans
      operationId: listPlans
      responses:
        '200':
          description: List of available plans
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Plan'

  /auth/register:
    post:
      tags: [Authentication]
      summary: Register a new user
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [first_name, last_name, email, password, password_confirmation]
              properties:
                first_name:
                  type: string
                  example: John
                last_name:
                  type: string
                  example: Doe
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                password_confirmation:
                  type: string
                  format: password
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/login:
    post:
      tags: [Authentication]
      summary: Login user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: Logout user
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logged out successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/forgot-password:
    post:
      tags: [Authentication]
      summary: Request password reset
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Password reset email sent

  /auth/reset-password:
    post:
      tags: [Authentication]
      summary: Reset password
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, email, password, password_confirmation]
              properties:
                token:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                password_confirmation:
                  type: string
                  format: password
      responses:
        '200':
          description: Password reset successfully

  /user:
    get:
      tags: [User]
      summary: Get current user profile
      operationId: getUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
    put:
      tags: [User]
      summary: Update user profile
      operationId: updateUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Profile updated
    delete:
      tags: [User]
      summary: Delete user account
      operationId: deleteUser
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Account deleted

  /workspaces:
    get:
      tags: [Workspaces]
      summary: List workspaces
      operationId: listWorkspaces
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of workspaces
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workspace'
    post:
      tags: [Workspaces]
      summary: Create workspace
      operationId: createWorkspace
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '201':
          description: Workspace created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Workspace'

  /workspaces/{workspace}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Workspaces]
      summary: Get workspace details
      operationId: getWorkspace
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Workspace details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Workspace'
    put:
      tags: [Workspaces]
      summary: Update workspace
      operationId: updateWorkspace
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Workspace updated
    delete:
      tags: [Workspaces]
      summary: Delete workspace
      operationId: deleteWorkspace
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Workspace deleted

  /workspaces/{workspace}/workflows:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Workflows]
      summary: List workflows
      operationId: listWorkflows
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workflow'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
    post:
      tags: [Workflows]
      summary: Create workflow
      operationId: createWorkflow
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowInput'
      responses:
        '201':
          description: Workflow created

  /workspaces/{workspace}/workflows/{workflow}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/WorkflowId'
    get:
      tags: [Workflows]
      summary: Get workflow details
      operationId: getWorkflow
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Workflow details
    put:
      tags: [Workflows]
      summary: Update workflow
      operationId: updateWorkflow
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowInput'
      responses:
        '200':
          description: Workflow updated
    delete:
      tags: [Workflows]
      summary: Delete workflow
      operationId: deleteWorkflow
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Workflow deleted

  /workspaces/{workspace}/workflows/{workflow}/activate:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/WorkflowId'
    post:
      tags: [Workflows]
      summary: Activate workflow
      operationId: activateWorkflow
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Workflow activated

  /workspaces/{workspace}/workflows/{workflow}/deactivate:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/WorkflowId'
    post:
      tags: [Workflows]
      summary: Deactivate workflow
      operationId: deactivateWorkflow
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Workflow deactivated

  /workspaces/{workspace}/workflows/{workflow}/execute:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/WorkflowId'
    post:
      tags: [Executions]
      summary: Execute workflow
      operationId: executeWorkflow
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                input:
                  type: object
                  description: Input data for the workflow
      responses:
        '202':
          description: Execution started
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Execution'

  /workspaces/{workspace}/executions:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Executions]
      summary: List executions
      operationId: listExecutions
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, running, completed, failed, cancelled]
        - name: workflow_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of executions

  /workspaces/{workspace}/executions/stats:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Executions]
      summary: Get execution statistics
      operationId: getExecutionStats
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Execution statistics

  /workspaces/{workspace}/executions/{execution}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ExecutionId'
    get:
      tags: [Executions]
      summary: Get execution details
      operationId: getExecution
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Execution details

  /workspaces/{workspace}/executions/{execution}/cancel:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ExecutionId'
    post:
      tags: [Executions]
      summary: Cancel execution
      operationId: cancelExecution
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Execution cancelled

  /workspaces/{workspace}/executions/{execution}/retry:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ExecutionId'
    post:
      tags: [Executions]
      summary: Retry execution
      operationId: retryExecution
      security:
        - bearerAuth: []
      responses:
        '202':
          description: Execution retry started

  /workspaces/{workspace}/credentials:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Credentials]
      summary: List credentials
      operationId: listCredentials
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of credentials
    post:
      tags: [Credentials]
      summary: Create credential
      operationId: createCredential
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CredentialInput'
      responses:
        '201':
          description: Credential created

  /workspaces/{workspace}/webhooks:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Webhooks]
      summary: List webhooks
      operationId: listWebhooks
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of webhooks
    post:
      tags: [Webhooks]
      summary: Create webhook
      operationId: createWebhook
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Webhook created

  /workspaces/{workspace}/variables:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Variables]
      summary: List variables
      operationId: listVariables
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of variables
    post:
      tags: [Variables]
      summary: Create variable
      operationId: createVariable
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, value]
              properties:
                key:
                  type: string
                value:
                  type: string
                is_secret:
                  type: boolean
                  default: false
      responses:
        '201':
          description: Variable created

  /workspaces/{workspace}/tags:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      tags: [Tags]
      summary: List tags
      operationId: listTags
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of tags
    post:
      tags: [Tags]
      summary: Create tag
      operationId: createTag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                color:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
      responses:
        '201':
          description: Tag created

  /nodes:
    get:
      tags: [Nodes]
      summary: List available nodes
      operationId: listNodes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of available node types

  /nodes/categories:
    get:
      tags: [Nodes]
      summary: List node categories
      operationId: listNodeCategories
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of node categories

  /nodes/search:
    get:
      tags: [Nodes]
      summary: Search nodes
      operationId: searchNodes
      security:
        - bearerAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Search results

  /nodes/{type}:
    parameters:
      - name: type
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Nodes]
      summary: Get node details
      operationId: getNode
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Node details

  /credential-types:
    get:
      tags: [Credentials]
      summary: List credential types
      operationId: listCredentialTypes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of credential types

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    WorkspaceId:
      name: workspace
      in: path
      required: true
      description: Workspace UUID
      schema:
        type: string
        format: uuid
    WorkflowId:
      name: workflow
      in: path
      required: true
      description: Workflow UUID
      schema:
        type: string
        format: uuid
    ExecutionId:
      name: execution
      in: path
      required: true
      description: Execution UUID
      schema:
        type: string
        format: uuid

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Unauthenticated.
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
              errors:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        avatar:
          type: string
          nullable: true
        email_verified_at:
          type: string
          format: date-time
          nullable: true
        avatar_url:
          type: string
          format: uri
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AuthResponse:
      type: object
      required: [message, user, access_token, refresh_token, token_type, expires_in]
      properties:
        message:
          type: string
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          description: Seconds until access token expiry

    RefreshTokenResponse:
      type: object
      required: [message, access_token, refresh_token, token_type, expires_in]
      properties:
        message:
          type: string
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          description: Seconds until access token expiry

    Workspace:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        owner_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Workflow:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        is_active:
          type: boolean
        trigger_type:
          type: string
          enum: [manual, webhook, schedule, event]
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowNode'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowEdge'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WorkflowInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        trigger_type:
          type: string
          enum: [manual, webhook, schedule, event]
        trigger_config:
          type: object
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowNode'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowEdge'

    WorkflowNode:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        name:
          type: string
        config:
          type: object
        position:
          type: object
          properties:
            x:
              type: number
            y:
              type: number

    WorkflowEdge:
      type: object
      properties:
        id:
          type: string
        source:
          type: string
        target:
          type: string
        condition:
          type: object
          nullable: true

    Execution:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workflow_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, running, completed, failed, cancelled]
        started_at:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true
        input:
          type: object
        output:
          type: object
          nullable: true
        error:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    CredentialInput:
      type: object
      required: [name, type, data]
      properties:
        name:
          type: string
        type:
          type: string
        data:
          type: object
          description: Encrypted credential data

    Plan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        price_monthly:
          type: number
        price_yearly:
          type: number
        features:
          type: array
          items:
            type: string

    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
        from:
          type: integer
        last_page:
          type: integer
        per_page:
          type: integer
        to:
          type: integer
        total:
          type: integer
